!function(i){i.module("ionicSettings.constants",[]).constant("IONIC_SETTINGS_BUTTON","button").constant("IONIC_SETTINGS_PIN","pin").constant("IONIC_SETTINGS_PIN_EMPTY","○").constant("IONIC_SETTINGS_PIN_FILLED","●").constant("IONIC_SETTINGS_SELECTION","selection").constant("IONIC_SETTINGS_TEXT","text"),i.module("ionicSettings.directives",[]).directive("ionSettings",["$ionicSettings","$ionicSettingsConfig","IONIC_SETTINGS_PIN",function(n,t,e){return{restrict:"E",scope:!0,template:'<div ng-repeat="(key, item) in data"><div class="item item-divider" ng-if="!item.type">{{item}}</div><div ng-if="item.type"><ion-item class="item-icon-right"ng-class="{\'item-icon-left\': item.icon}"ng-if="item.type == \'selection\' || item.type == \'button\' || item.type == \'text\'"ng-click="doAction(key)"><div class="ionic-settings-left">{{item.label}}</div><div class="ionic-settings-right ionic-settings-ios" ng-if="!isAndroid && item.type !== \'button\' && item.type !== \'text\'">{{item.value}}</div><div class="ionic-settings-android" ng-if="isAndroid && item.type !== \'button\' && item.type !== \'text\'">{{item.value}}</div><i class="icon {{elementColor}} ionic-settings-icon-smaller {{item.icon}}" ng-if="item.icon"></i><i class="icon {{elementColor}} icon-accessory ion-chevron-right" ng-hide="isAndroid || item.type === \'button\'"></i></ion-item><ion-toggle ng-class="{\'item-icon-left\': item.icon}"toggle-class="toggle-{{color}}"ng-if="item.type === \'toggle\'"ng-model="item.value">{{item.label}}<i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.icon}}" ng-if="item.icon"></i></ion-toggle><ion-toggle ng-class="{\'item-icon-left\': item.icon}"toggle-class="toggle-{{color}}"ng-if="item.type === \'pin\'"ng-change="doAction(key)"ng-init="pin.active = item.value.length === 4"ng-model="pin.active">{{item.label}}<i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.icon}}" ng-if="item.icon"></i></ion-toggle><div class="item item-icon-left" ng-if="item.type === \'input\' && item.icon"><i class="icon {{elementColor}} ionic-settings-icon-smaller {{item.icon}}" ng-if="item.icon"></i><label class="item item-borderless item-input"><span class="input-label" style="margin-left: -13px;">{{item.label}}</span><input type="{{item.inputType}}" ng-model="item.value"></label></div><label class="item item-input" ng-if="item.type === \'input\' && !item.icon"><span class="input-label">{{item.label}}</span><input type="{{item.inputType}}" ng-model="item.value"></label><label class="item" ng-if="item.type === \'range\'"><div class="item-content">{{item.label}}</div><div class="range range-{{color}}"><i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.iconLeft}}"></i><input type="range" name="volume" min="{{item.min}}" max="{{item.max}}" ng-model="item.value"><i class="icon ionic-settings-icon-smaller {{elementColor}} {{item.iconRight}}"></i></div></label></div></div>',link:function(o){var l={},c={};o.data=n.getData(),o.groupCount=Object.keys(o.data).length,o.isAndroid=t.isAndroid,o.iconClose=t.iconClose,o.iconClosePosition=t.iconClosePosition,o.iconSelected=t.isAndroid?"ion-android-done":"ion-ios-checkmark-empty",o.pin={active:!1},o.showing=!1,o.color=t.color,o.elementColor="stable"===o.color||"default"===o.color||"light"===o.color?"dark":o.color,o.barColor="bar-"+o.color,i.forEach(o.data,function(t,e){c[e]=n.createModal(o,e),o.$watch("data."+e+".value",function(t,l){i.isDefined(t)&&t!==l&&n.store(e,t).then(function(){o.$root.$broadcast(n.changed,{key:e,value:t})},function(){o.data[e].value=l})})}),o.addValue=function(i){4===o.value.length&&(o.value=""),o.value+=i},o.clear=function(){o.value=""},o.deleteValue=function(){o.value.length>0&&(o.value=o.value.substring(0,o.value.length-1))},o.dismiss=function(){l.item.type===e&&((0===o.value.length||4===o.value.length)&&(l.item.value=o.value),o.pin.active=4===o.value.length),l.modal.hide().then(function(){l={}})},o.hidePin=function(){o.showing=!1},o.doAction=function(t){if(l.modal=c[t],l.modal)l.item=o.data[t],l.item.type===e&&4===l.item.value.length?l.item.value="":(o.value=l.item.value,l.modal.show());else{var s=o.data[t];i.isFunction(s.onClick)?s.onClick():o.$root.$broadcast(n.changed,{key:t,value:o.value})}},o.showPin=function(){o.showing=!0},o.$on("$destroy",function(){for(key in c)c[key]&&c[key].remove()})}}}]).directive("ionSettingsButton",["$ionicSettingsConfig","$ionicSettings",function(i,n){return{template:'<button class="button button-icon icon {{icon}}" ng-click="settingsModal.show()"></button>',$scope:!0,link:function(t){t.barColor="bar-"+i.color,t.icon=i.icon,t.iconClose=i.iconClose,t.iconClosePosition=i.iconClosePosition,t.settingsModal=n.createModal(t),t.title=i.title,t.dismiss=function(){t.settingsModal.hide()}}}}]).directive("ngTouchstart",function(){return{controller:["$scope","$element",function(i,n){function t(t){var e=n.attr("ng-touchstart");i.$event=t,i.$apply(e)}n.bind("touchstart",t)}]}}).directive("ngTouchend",function(){return{controller:["$scope","$element",function(i,n){function t(t){var e=n.attr("ng-touchend");i.$event=t,i.$apply(e)}n.bind("touchend",t)}]}}),i.module("ionicSettings.providers",[]).provider("$ionicSettingsConfig",function(){var i=ionic.Platform.isAndroid(),n="positive",t=i?"ion-android-settings":"ion-ios-gear",e=i?"ion-android-close":"ion-ios-close-empty",o="right",l=i?"ionic-settings-animate-modal-android":"slide-in-up",c="Settings",s=!0;return{setAndroid:function(n){i=n},setIcon:function(i){t=i},setIconClose:function(i){e=i},setIconClosePosition:function(i){o=i},setModalAnimation:function(i){l=i},setColor:function(i){n=i},setTitle:function(i){c=i},setTouchID:function(i){s=i},$get:function(){return{color:n,icon:t,iconClose:e,iconClosePosition:o,isAndroid:i,modalAnimation:l,title:c,touchID:s}}}}),i.module("ionicSettings.services",[]).factory("$ionicSettings",["$ionicSettingsConfig","$ionicModal","$q","$rootScope","$window","IONIC_SETTINGS_PIN","IONIC_SETTINGS_SELECTION","IONIC_SETTINGS_TEXT",function(n,t,e,o,l,c,s,a){var r,u=this,d={},g=!0;return u.changed="$ionicSettings.changed",u.onInvalidPin="$ionicSettings.onInvalidPin",u.onValidPin="$ionicSettings.onValidPin",u.createModal=function(i,e){var o;if(e){var l=d[e];switch(l.type){case s:o='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">'+l.label+'</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content><label class="item item-radio"collection-repeat="item in data.'+e+'.data"item-height="54px"item-width="101%"ng-click="dismiss()"><input type="radio"name="radio-group"ng-model="data.'+e+'.value"ng-value="item"><div class="radio-content"><div class="item-content disable-pointer-events">{{item}}</div><i class="radio-icon disable-pointer-events icon ionic-settings-icon-larger {{color}} {{iconSelected}}"></i></div></label></ion-content></ion-modal-view>';break;case c:o='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">'+l.label+'</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content class="center-vertical"><center><div class="row" style="margin-top: 30px;"><div class="col col-10" ng-repeat="$index in [1,2,3,4]" ng-if="!showing" ng-class="{\'ionic-settings-col-offset-30\': $index === 0}"><i class="icon ionic-settings-icon-smaller" ng-class="{\'ion-ios-circle-outline\': value.length <= $index, \'ion-ios-circle-filled\': value.length > $index}"></i></div><div class="col col-10" ng-repeat="$index in [1,2,3,4]" ng-if="showing" ng-class="{\'ionic-settings-col-offset-30\': $index === 0}"><span style="font-size: 38px;">{{value[$index]}}</span></div></div><div style="margin-top: 30px;"><div class="row"><div class="col col-25"ng-repeat="col in [1,2,3]"ng-class="{\'ionic-settings-col-offset-12\': $index === 0}"><button class="button button-outline button-{{color}} ionic-settings-rounded" ng-click="addValue(col)">{{col}}</button></div></div><div class="row""><div class="col col-25"ng-repeat="col in [4,5,6]"ng-class="{\'ionic-settings-col-offset-12\': $index === 0}"><button class="button button-outline button-{{color}} ionic-settings-rounded" ng-click="addValue(col)">{{col}}</button></div></div><div class="row"><div class="col col-25"ng-repeat="col in [7,8,9]"ng-class="{\'ionic-settings-col-offset-12\': $index === 0}"><button class="button button-outline button-{{color}} ionic-settings-rounded" ng-click="addValue(col)">{{col}}</button></div></div><div class="row"><div class="col col-25 ionic-settings-col-offset-12"><button class="button button-outline button-{{color}} ionic-settings-rounded" ng-hide="start" ng-click="clear()">C</button></div><div class="col col-25"><button class="button button-outline button-{{color}} ionic-settings-rounded" ng-click="addValue(0)">0</button></div><div class="col col-25"><button class="button button-outline button-{{color}} ionic-settings-rounded icon ion-eye"ng-hide="start"ng-disabled="value.length !== 4"ng-mousedown="showPin()"ng-mouseup="hidePin()"ng-touchstart="showPin()"ng-touchend="hidePin()"></button></div></div></div></center></ion-content></ion-modal-view>';break;case a:o='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">'+l.label+'</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content>'+l.value+"</ion-content></ion-modal-view>"}}else o='<ion-modal-view><ion-header-bar ng-class="barColor"><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'left\'" ng-click="dismiss()"></button><h1 class="title">{{title}}</h1><button class="button button-icon {{iconClose}}" ng-if="iconClosePosition === \'right\'" ng-click="dismiss()"></button></ion-header-bar><ion-content><ion-settings></ion-settings></ion-content></ion-modal-view>';return o?t.fromTemplate(o,{scope:i,animation:n.modalAnimation}):void 0},u.fetch=function(i){var n=e.defer();if(l.plugins)l.plugins.appPreferences.fetch(i).then(function(t){null===t?n.reject(t):n.resolve({key:i,value:t})},function(i){n.reject(new Error(i))});else{var t=localStorage[i];void 0===t?n.reject(t):(("true"===t||"false"===t)&&(t="true"===t),n.resolve({key:i,value:t}))}return n.promise},u.fetchAll=function(){var n=[];for(key in d){var t=d[key];i.isObject(t)&&n.push(u.fetch(key))}return e.all(n).then(function(i){for(var n in i){var t=i[n],e=t.key,o=t.value,l=d[e];l.value=o,l.type===c&&(r={key:e,value:o})}return d})},u.get=function(i){return d[i].value},u.getData=function(){return d},u.init=function(i){d=i;var t=e.defer();return u.fetchAll().then(function(i){if(r&&4===r.value.length){var e=o.$new(),l=u.createModal(e,r.key);e.color=n.color,e.barColor="bar-"+e.color,e.start=!0,e.value="",e.valid=!1;var c=d[r.key];c.onValid&&e.$on(u.onValidPin,c.onValid),c.onInvalid&&e.$on(u.onInvalidPin,c.onInvalid),e.addValue=function(n){e.value+=n,4===e.value.length&&(e.valid=e.value===r.value,e.valid?l.remove().then(function(){if(t.resolve(i),o.$broadcast(u.onValidPin),g)try{navigator.splashscreen.show()}catch(n){}}):(o.$broadcast(u.onInvalidPin,e.value),e.clear())),e.value.length>4&&(e.clear(),e.value+=n)},e.clear=function(){e.value=""},l.show().then(function(){try{navigator.splashscreen.hide()}catch(e){g=!1}if(n.touchID)try{touchid.checkSupport(function(){touchid.authenticate(function(){t.resolve(i)},function(){},"Touch ID")})}catch(e){}})}else t.resolve(i)},function(){u.storeAll(i).then(function(i){t.resolve(i)})}),t.promise},u.store=function(i,n){var t=e.defer();return l.plugins?l.plugins.appPreferences.store(i,n).then(function(i){t.resolve(i)},function(i){t.reject(new Error(i))}):(localStorage[i]=n,t.resolve(localStorage[i])),t.promise},u.storeAll=function(){var n=[];for(key in d){var t=d[key];i.isObject(t)&&n.push(u.store(key,t.value))}return e.all(n)},u}]),i.module("ionicSettings",["ionicSettings.constants","ionicSettings.directives","ionicSettings.providers","ionicSettings.services"])}(angular);